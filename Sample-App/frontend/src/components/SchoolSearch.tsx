import React,{useEffect,useState}from "react";import {searchSchools,type School}from "../lib/api";import {Input}from "./ui/input";import {Button}from "./ui/button";import {Badge}from "./ui/badge";import {Card}from "./ui/card";export const SchoolSearch:React.FC<{user:any;onViewDetails:(index:number)=>void}>=({onViewDetails})=>{const[q,setQ]=useState("");const[level,setLevel]=useState("");const[zone,setZone]=useState("");const[type,setType]=useState("");const[items,setItems]=useState<School[]>([]);const[loading,setLoading]=useState(false);const[error,setError]=useState<string|null>(null);async function load(){try{setError(null);setLoading(true);const data=await searchSchools({q,level,zone,type});setItems(data);}catch(e:any){setError(e.message||"Failed to load");}finally{setLoading(false);}}useEffect(()=>{load();},[]);useEffect(()=>{load();},[level,zone,type]);return(<Card className="p-4 space-y-3"><div className="flex gap-2"><Input placeholder="Search schools..." value={q} onChange={e=>setQ(e.target.value)}/><Button onClick={load}>Search</Button></div><div className="grid sm:grid-cols-3 gap-2"><select className="border border-border rounded-lg px-2 py-2" value={level} onChange={e=>setLevel(e.target.value)}><option value="">Any level</option><option value="PRIMARY">Primary</option><option value="SECONDARY">Secondary</option><option value="JUNIOR_COLLEGE">Junior College</option><option value="POLYTECHNIC">Polytechnic</option><option value="UNIVERSITY">University</option></select><select className="border border-border rounded-lg px-2 py-2" value={zone} onChange={e=>setZone(e.target.value)}><option value="">Any zone</option><option value="NORTH">North</option><option value="SOUTH">South</option><option value="EAST">East</option><option value="WEST">West</option><option value="CENTRAL">Central</option></select><select className="border border-border rounded-lg px-2 py-2" value={type} onChange={e=>setType(e.target.value)}><option value="">Any type</option><option value="GOVERNMENT">Government</option><option value="GOV_AIDED">Gov Aided</option><option value="INDEPENDENT">Independent</option><option value="SPECIALISED">Specialised</option></select></div><div className="grid gap-2">{error&&<div className="text-red-600">{error}</div>}{loading&&<div className="text-muted">Loadingâ€¦</div>}{!loading&&items.length===0&&<div className="text-muted">No results.</div>}{items.map((s,idx)=>{const name=s.school_name||s.name||"Unnamed School";const address=s.address||"";const lev=s.mainlevel_code||"";const z=s.zone_code||"";const t=s.type_code||"";return(<div key={idx} className="card p-3 flex gap-3 items-center"><img className="w-24 h-16 rounded-lg object-cover border border-border" src={`https://picsum.photos/seed/${encodeURIComponent(name)}/200/120`} /><div className="flex-1"><div className="font-semibold flex items-center gap-2">{name} {lev&&<Badge>{lev}</Badge>}</div><div className="text-sm text-muted">{address}</div><div className="flex gap-2 mt-1">{t&&<Badge>{t}</Badge>}{z&&<Badge>{z}</Badge>}</div></div><Button onClick={()=>onViewDetails(idx)}>Details</Button></div>);})}</div></Card>)};